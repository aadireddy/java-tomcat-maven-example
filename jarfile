pipeline{
 agent any
  stages{
    stage('git clone'){
     steps{
	  git 'https://github.com/nishanthchowdary/java-tomcat-maven-example.git'
	 }
    }
    stage('build'){
	 tools{
	  maven 'maven'
	 }
	 steps{
	 sh 'mvn clean package'
	 }
	}
      stage(imagebuild){
         steps{
          sh "docker build . -t java:$BUILD_NUMBER"
         }
       }
       stage(imagetag){
           steps{
               sh "docker tag java:$BUILD_NUMBER 13.127.117.244:8086/java:$BUILD_NUMBER"
           }
       }
       stage(pushimage){
         steps{
          withCredentials([usernamePassword(credentialsId: '1111', passwordVariable: 'docker123', usernameVariable: 'docker')]) {
            sh "docker login -u ${NEXUS_USER} -p ${NEXUS_PASSWORD} 13.127.117.244:8086"
          }
            sh "docker push 13.127.117.244:8086/java:$BUILD_NUMBER"
       }
       }
  }
}
